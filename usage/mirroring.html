<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Strict mode - Packeton Docs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Introduction</li><li class="chapter-item expanded "><a href="../index.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Setup</li><li class="chapter-item expanded "><a href="../installation.html">Installation</a></li><li class="chapter-item expanded "><a href="../installation-docker.html">Using docker</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="../usage/index.html">Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../usage/api.html">Admin API</a></li><li class="chapter-item expanded "><a href="../webhook.html">Outgoing Webhook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../webhook.html">Intro</a></li><li class="chapter-item expanded "><a href="../webhook.html">Examples</a></li><li class="chapter-item expanded "><a href="../webhook/webhook-secrets.html">Secrets</a></li><li class="chapter-item expanded "><a href="../webhook/wh-security.html">Security Policy</a></li><li class="chapter-item expanded "><a href="../webhook/wh-test.html">Testing</a></li></ol></li><li class="chapter-item expanded "><a href="../usage/update-packages.html">Update Webhooks</a></li><li class="chapter-item expanded "><a href="../usage/customers.html">Customer Users</a></li><li class="chapter-item expanded "><a href="../usage/credential.html">SSH Credential</a></li><li class="chapter-item expanded "><a href="../usage/mirroring.html" class="active">Mirroring Packages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../usage/mirroring.html" class="active">Configuration</a></li><li class="chapter-item expanded "><a href="../usage/mirroring.html" class="active">Strict mode</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../authentication.html">User Authentication</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../authentication-jwt.html">JWT Configuration</a></li><li class="chapter-item expanded "><a href="../authentication-ldap.html">LDAP Configuration</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Development</li><li class="chapter-item expanded "><a href="../dev/CONTRIBUTING.html">Contributing</a></li><li class="chapter-item expanded "><a href="../dev/configuration.html">Configuration Reference</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Packeton Docs</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vtsykun/packeton" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/vtsykun/packeton/edit/master/docs/usage/mirroring.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mirroring-and-composer-proxies"><a class="header" href="#mirroring-and-composer-proxies">Mirroring and Composer proxies</a></h1>
<p>Packeton may work as a proxy for the composer's repository, including requiring an authorization.
This can be used to give all developers and clients access to private repositories like Magento.
Also, possible to create zip archives from git repositories of mirroring packages, if http dist is not available.</p>
<h2 id="main-features"><a class="header" href="#main-features">Main Features</a></h2>
<ul>
<li>Support full and lazy sync for all - smail and big composer repositories.</li>
<li>Support Packagist fast <code>metadata-changes-url</code> API.</li>
<li>Strict mode and Dependencies approvement.</li>
<li>Dist mirroring</li>
</ul>
<p>Example metadata with Strict mode and manual dependencies approvement.</p>
<pre><code class="language-json">{
    &quot;includes&quot;: {
        &quot;include-packeton/all$f05f56b8bd12d014a753cdbe6a7d749facd40908.json&quot;: {
            &quot;sha1&quot;: &quot;f05f56b8bd12d014a753cdbe6a7d749facd40908&quot;
        }
    },
    &quot;mirrors&quot;: [
        {
            &quot;dist-url&quot;: &quot;/mirror/orocrm/zipball/%package%/%version%/%reference%.%type%&quot;,
            &quot;preferred&quot;: true
        }
    ],
    &quot;metadata-url&quot;: &quot;/mirror/orocrm/p2/%package%.json&quot;,
    &quot;available-packages&quot;: [
        &quot;romanpitak/dotmailer-api-v2-client&quot;,
        &quot;oro/platform-enterprise&quot;,
        &quot;oro/crm-enterprise&quot;,
        &quot;oro/api-doc-bundle&quot;,
        &quot;oro/flotr2&quot;,
        &quot;oro/crm-pro-ldap-bundle&quot;,
        &quot;oro/multi-host&quot;,
        &quot;akeneo/batch-bundle&quot;
    ]
}
</code></pre>
<p>Original metadata is:</p>
<pre><code class="language-json">{
    &quot;packages&quot;: [],
    &quot;providers-url&quot;: &quot;/p/%package%$%hash%.json&quot;,
    &quot;providers&quot;: {
        &quot;actualys/drupal-commerce-connector-bundle&quot;: {
            &quot;sha256&quot;: &quot;4163f3b470b3b824cbcebee5a0d58ea3d516b7b5fa78617ba21120eeec9e494f&quot;
        },
        &quot;agencednd/oro-api-connector-bundle&quot;: {
            &quot;sha256&quot;: &quot;169c0963fd8442c190f2e9303e0e6fa1fe9ad0c9fb2f6782176d02e65a48eada&quot;
        },
        &quot;akeneo/batch-bundle&quot;: {
            &quot;sha256&quot;: &quot;4f2c1b9a43124524da45b35236acabd3ee1ad329980b885089e9eb408c1bca01&quot;
        },
    ...
    + 57 packages
</code></pre>
<p>For performance if composer user-agent is not 1 we remove <code>includes</code> and use <code>providers-lazy-url</code></p>
<p><a href="../img/packeton_proxies.png">logo</a></p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>Example how to enable proxies in your local configuration.
Create a file <code>config/packages/any-name.yaml</code> with config.</p>
<pre><code class="language-yaml">packeton:
    mirrors:
        packagist:
            url: https://repo.packagist.org
        orocrm:
            url: https://satis.oroinc.com/
            git_ssh_keys:
                git@github.com:oroinc: '/var/www/.ssh/private_key1'
                git@github.com:org2: '/var/www/.ssh/private_key2'
        example:
            url: https://satis.example.com/
            logo: 'https://example.com/logo.png'
            http_basic:
                username: 123
                password: 123
            sync_lazy: true # default false 
            enable_dist_mirror: false # default true
            available_package_patterns: # Additional restriction, but you can restrict it in UI
                - 'vend1/*' 
            available_packages:
                - 'pack1/name1' # but you can restrict it in UI
            composer_auth: '{&quot;...&quot;}' # JSON. auth.json to pass composer opts.
            sync_interval: 3600 # default auto.
            info_cmd_message: &quot;\n\u001b[37;44m#Слава\u001b[30;43mУкраїні!\u001b[0m\n\u001b[40;31m#Смерть\u001b[30;41mворогам\u001b[0m&quot; # Info message
</code></pre>
<h2 id="metadata-proxy-specification"><a class="header" href="#metadata-proxy-specification">Metadata proxy specification.</a></h2>
<p>It depends on the type of repository and sync strategy.</p>
<div class="table-wrapper"><table><thead><tr><th>API</th><th>Full sync</th><th>Lazy sync</th><th>Mirroring (strict)</th></tr></thead><tbody>
<tr><td>V1</td><td>provider-includes (parent)</td><td>providers-lazy-url</td><td>includes</td></tr>
<tr><td>V2</td><td>meta v2 + available-packages (depends on size)</td><td>meta v2</td><td>meta v2 + available-packages</td></tr>
</tbody></table>
</div>
<h3 id="default-sync-intervals"><a class="header" href="#default-sync-intervals">Default sync intervals</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Repo</th><th>Interval in sec.</th></tr></thead><tbody>
<tr><td>Packagist.org</td><td>900</td></tr>
<tr><td>Lazy and API v2</td><td>1800</td></tr>
<tr><td>Lazy and API v1</td><td>7200</td></tr>
<tr><td>Full</td><td>86400</td></tr>
</tbody></table>
</div>
<h2 id="manual-approve-dependencies"><a class="header" href="#manual-approve-dependencies">Manual approve dependencies</a></h2>
<p>By default, all new packages are automatically enabled and added to your repository then you run composer update. But you can 
enable strict mode to use only approved packages and avoid including into metadata untrusted packages.
This can be useful to prevent dependency confusion attacks, for example if you use 3-d party composer repo like this <code>https://satis.oroinc.com/</code>
See about <a href="https://blog.packagist.com/preventing-dependency-hijacking">dependency confusion</a> </p>
<p>To enable strict mode go to proxy settings page Composer proxies -&gt; Packagist (or any name) -&gt; Settings</p>
<p><a href="../img/mirr1.png">strict</a></p>
<p>Next go to view proxy page and click &quot;Mass mirror packages&quot; button</p>
<p><a href="../img/mirr2.png">strict</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../usage/credential.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../usage/mirroring.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../usage/credential.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../usage/mirroring.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
